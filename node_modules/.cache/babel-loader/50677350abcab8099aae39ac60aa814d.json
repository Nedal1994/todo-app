{"ast":null,"code":"var _jsxFileName = \"/home/nedal/todo-app/src/components/todo/context/loginContext.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport cookie from 'react-cookies';\nimport jwt from 'jsonwebtoken';\nimport base64 from 'base-64';\nimport { superagent } from 'superagent';\nimport { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst testUsers = {\n  admin: {\n    password: \"password\",\n    name: \"Administrator\",\n    role: \"admin\",\n    capabilities: [\"create\", \"read\", \"update\", \"delete\"]\n  },\n  editor: {\n    password: \"password\",\n    name: \"Editor\",\n    role: \"editor\",\n    capabilities: [\"read\", \"update\"]\n  },\n  writer: {\n    password: \"password\",\n    name: \"Writer\",\n    role: \"writer\",\n    capabilities: [\"create\"]\n  }\n};\nexport const LoginContext = /*#__PURE__*/React.createContext();\nconst API = \"https://lap8.herokuapp.com/\";\nexport default function LoginProvider(props) {\n  _s();\n\n  let [loggedIn, setloggedIn] = useState(false);\n  let [user, setUser] = useState({\n    capabilities: []\n  });\n  let [token, setToken] = useState(\"\");\n\n  const can = capability => {\n    var _user$capabilities;\n\n    return user === null || user === void 0 ? void 0 : (_user$capabilities = user.capabilities) === null || _user$capabilities === void 0 ? void 0 : _user$capabilities.includes(capability);\n  };\n\n  const login = async (username, password) => {\n    try {\n      const response = await superagent.post(`${API}/signin`).set(\"authorization\", `Basic ${base64.encode(`${username}:${password}`)}`);\n      console.log(response.body);\n      validateMyToken(response.body.token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const logout = () => {\n    setLoginState(false, null, {});\n  };\n\n  const validateToken = async token => {\n    try {\n      let user = jwt.verify(token, process.env.REACT_APP_SECRET || \"2000\");\n      setLoginState(true, token, user);\n    } catch (e) {\n      setLoginState(false, null, {});\n      console.log(\"Token Validation Error\", e);\n    }\n  };\n\n  const signUp = async (username, password, role) => {\n    try {\n      let obj = {\n        username: username,\n        password: password,\n        role: role\n      };\n      const response = await superagent.post(`${API}/signup`, obj);\n      console.log(response.body);\n      validateMyToken(response.body.token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const setLoginState = (loggedIn, token, user) => {\n    cookie.save(\"auth\", token);\n    setloggedIn(loggedIn);\n    setToken(token);\n    setUser(user);\n  };\n\n  useEffect(() => {\n    const qs = new URLSearchParams(window.location.search);\n    const cookieToken = cookie.load(\"auth\");\n    const token = qs.get(\"token\") || cookieToken || null;\n    validateToken(token);\n  });\n  const state = {\n    loggedIn,\n    login,\n    logout,\n    user,\n    token,\n    can,\n    signUp: signUp\n  };\n  return /*#__PURE__*/_jsxDEV(LoginContext.Provider, {\n    value: state,\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n}\n\n_s(LoginProvider, \"D5iihokT1qm+Rh+PG9b4o02YT+w=\");\n\n_c = LoginProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginProvider\");","map":{"version":3,"sources":["/home/nedal/todo-app/src/components/todo/context/loginContext.js"],"names":["React","cookie","jwt","base64","superagent","useState","useEffect","testUsers","admin","password","name","role","capabilities","editor","writer","LoginContext","createContext","API","LoginProvider","props","loggedIn","setloggedIn","user","setUser","token","setToken","can","capability","includes","login","username","response","post","set","encode","console","log","body","validateMyToken","err","logout","setLoginState","validateToken","verify","process","env","REACT_APP_SECRET","e","signUp","obj","save","qs","URLSearchParams","window","location","search","cookieToken","load","get","state","children"],"mappings":"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","sourcesContent":["import React from 'react';\nimport cookie from 'react-cookies';\nimport jwt from 'jsonwebtoken';\nimport base64 from 'base-64'\nimport {superagent } from 'superagent';\nimport { useState,useEffect } from 'react';\n\nconst testUsers = {\n  admin: {\n    password: \"password\",\n    name: \"Administrator\",\n    role: \"admin\",\n    capabilities: [\"create\", \"read\", \"update\", \"delete\"],\n  },\n  editor: {\n    password: \"password\",\n    name: \"Editor\",\n    role: \"editor\",\n    capabilities: [\"read\", \"update\"],\n  },\n  writer: {\n    password: \"password\",\n    name: \"Writer\",\n    role: \"writer\",\n    capabilities: [\"create\"],\n  },\n};\n\nexport const LoginContext = React.createContext();\nconst API = \"https://lap8.herokuapp.com/\";\nexport default function LoginProvider(props) {\n  let [loggedIn, setloggedIn] = useState(false);\n  let [user, setUser] = useState({ capabilities: [] });\n  let [token, setToken] = useState(\"\");\n\n  const can = (capability) => {\n    return user?.capabilities?.includes(capability);\n  };\n\n  const login = async (username, password) => {\n    try {\n      const response = await superagent\n        .post(`${API}/signin`)\n        .set(\n          \"authorization\",\n          `Basic ${base64.encode(`${username}:${password}`)}`\n        );\n      console.log(response.body);\n      validateMyToken(response.body.token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const logout = () => {\n    setLoginState(false, null, {});\n  };\n\n  const validateToken = async (token) => {\n    try {\n      let user = jwt.verify(token, process.env.REACT_APP_SECRET || \"2000\");\n      setLoginState(true, token, user);\n    } catch (e) {\n      setLoginState(false, null, {});\n      console.log(\"Token Validation Error\", e);\n    }\n  };\n\n  const signUp = async (username, password, role) => {\n    try {\n      let obj = {\n        username: username,\n        password: password,\n        role: role,\n      };\n      const response = await superagent.post(`${API}/signup`, obj);\n      console.log(response.body);\n      validateMyToken(response.body.token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const setLoginState = (loggedIn, token, user) => {\n    cookie.save(\"auth\", token);\n    setloggedIn(loggedIn);\n    setToken(token);\n    setUser(user);\n  };\n\n  useEffect(() => {\n    const qs = new URLSearchParams(window.location.search);\n    const cookieToken = cookie.load(\"auth\");\n    const token = qs.get(\"token\") || cookieToken || null;\n    validateToken(token);\n  });\n\n  const state = {\n    loggedIn,\n    login,\n    logout,\n    user,\n    token,\n    can,\n    signUp:signUp\n  };\n\n  return (\n    <LoginContext.Provider value={state}>\n      {props.children}\n    </LoginContext.Provider>\n  );\n}"]},"metadata":{},"sourceType":"module"}