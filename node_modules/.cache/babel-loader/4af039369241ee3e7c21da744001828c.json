{"ast":null,"code":"var _jsxFileName = \"/home/nedal/todo-app/src/components/todo/context/loginContext.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport cookie from 'react-cookies';\nimport jwt from 'jsonwebtoken';\nimport { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst testUsers = {\n  admin: {\n    password: \"password\",\n    name: \"Administrator\",\n    role: \"admin\",\n    capabilities: [\"create\", \"read\", \"update\", \"delete\"]\n  },\n  editor: {\n    password: \"password\",\n    name: \"Editor\",\n    role: \"editor\",\n    capabilities: [\"read\", \"update\"]\n  },\n  writer: {\n    password: \"password\",\n    name: \"Writer\",\n    role: \"writer\",\n    capabilities: [\"create\"]\n  }\n};\nexport const LoginContext = /*#__PURE__*/React.createContext();\nconst API = \"https://lap8.herokuapp.com/\";\nexport default function LoginProvider(props) {\n  _s();\n\n  let [loggedIn, setloggedIn] = useState(false);\n  let [user, setUser] = useState({\n    capabilities: []\n  });\n  let [token, setToken] = useState(\"\");\n\n  const can = capability => {\n    var _user$capabilities;\n\n    return user === null || user === void 0 ? void 0 : (_user$capabilities = user.capabilities) === null || _user$capabilities === void 0 ? void 0 : _user$capabilities.includes(capability);\n  };\n\n  const login = (username, password) => {\n    if (testUsers[username]) {\n      const token = jwt.sign(testUsers[username], process.env.REACT_APP_SECRET || \"2000\");\n      validateToken(token);\n    }\n  };\n\n  const logout = () => {\n    setLoginState(false, null, {});\n  };\n\n  const validateToken = async token => {\n    try {\n      let user = jwt.verify(token, process.env.REACT_APP_SECRET || \"2000\");\n      setLoginState(true, token, user);\n    } catch (e) {\n      setLoginState(false, null, {});\n      console.log(\"Token Validation Error\", e);\n    }\n  };\n\n  const signUp = async (username, password, role) => {\n    try {\n      let obj = {\n        username: username,\n        password: password,\n        role: role\n      };\n      const response = await superagent.post(`${API}/signup`, obj);\n      console.log(response.body);\n      validateMyToken(response.body.token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const setLoginState = (loggedIn, token, user) => {\n    cookie.save(\"auth\", token);\n    setloggedIn(loggedIn);\n    setToken(token);\n    setUser(user);\n  };\n\n  useEffect(() => {\n    const qs = new URLSearchParams(window.location.search);\n    const cookieToken = cookie.load(\"auth\");\n    const token = qs.get(\"token\") || cookieToken || null;\n    validateToken(token);\n  });\n  const state = {\n    loggedIn,\n    login,\n    logout,\n    user,\n    token,\n    can,\n    signUp: signUp\n  };\n  return /*#__PURE__*/_jsxDEV(LoginContext.Provider, {\n    value: state,\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n}\n\n_s(LoginProvider, \"D5iihokT1qm+Rh+PG9b4o02YT+w=\");\n\n_c = LoginProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginProvider\");","map":{"version":3,"sources":["/home/nedal/todo-app/src/components/todo/context/loginContext.js"],"names":["React","cookie","jwt","useState","useEffect","testUsers","admin","password","name","role","capabilities","editor","writer","LoginContext","createContext","API","LoginProvider","props","loggedIn","setloggedIn","user","setUser","token","setToken","can","capability","includes","login","username","sign","process","env","REACT_APP_SECRET","validateToken","logout","setLoginState","verify","e","console","log","signUp","obj","response","superagent","post","body","validateMyToken","err","save","qs","URLSearchParams","window","location","search","cookieToken","load","get","state","children"],"mappings":"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","sourcesContent":["import React from 'react';\nimport cookie from 'react-cookies';\nimport jwt from 'jsonwebtoken';\nimport { useState,useEffect } from 'react';\n\nconst testUsers = {\n  admin: {\n    password: \"password\",\n    name: \"Administrator\",\n    role: \"admin\",\n    capabilities: [\"create\", \"read\", \"update\", \"delete\"],\n  },\n  editor: {\n    password: \"password\",\n    name: \"Editor\",\n    role: \"editor\",\n    capabilities: [\"read\", \"update\"],\n  },\n  writer: {\n    password: \"password\",\n    name: \"Writer\",\n    role: \"writer\",\n    capabilities: [\"create\"],\n  },\n};\n\nexport const LoginContext = React.createContext();\nconst API = \"https://lap8.herokuapp.com/\";\nexport default function LoginProvider(props) {\n  let [loggedIn, setloggedIn] = useState(false);\n  let [user, setUser] = useState({ capabilities: [] });\n  let [token, setToken] = useState(\"\");\n\n  const can = (capability) => {\n    return user?.capabilities?.includes(capability);\n  };\n\n  const login = (username, password) => {\n    if (testUsers[username]) {\n      const token = jwt.sign(\n        testUsers[username],\n        process.env.REACT_APP_SECRET || \"2000\"\n      );\n      validateToken(token);\n    }\n  };\n\n  const logout = () => {\n    setLoginState(false, null, {});\n  };\n\n  const validateToken = async (token) => {\n    try {\n      let user = jwt.verify(token, process.env.REACT_APP_SECRET || \"2000\");\n      setLoginState(true, token, user);\n    } catch (e) {\n      setLoginState(false, null, {});\n      console.log(\"Token Validation Error\", e);\n    }\n  };\n\n  const signUp = async (username, password, role) => {\n    try {\n      let obj = {\n        username: username,\n        password: password,\n        role: role,\n      };\n      const response = await superagent.post(`${API}/signup`, obj);\n      console.log(response.body);\n      validateMyToken(response.body.token);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const setLoginState = (loggedIn, token, user) => {\n    cookie.save(\"auth\", token);\n    setloggedIn(loggedIn);\n    setToken(token);\n    setUser(user);\n  };\n\n  useEffect(() => {\n    const qs = new URLSearchParams(window.location.search);\n    const cookieToken = cookie.load(\"auth\");\n    const token = qs.get(\"token\") || cookieToken || null;\n    validateToken(token);\n  });\n\n  const state = {\n    loggedIn,\n    login,\n    logout,\n    user,\n    token,\n    can,\n    signUp:signUp\n  };\n\n  return (\n    <LoginContext.Provider value={state}>\n      {props.children}\n    </LoginContext.Provider>\n  );\n}"]},"metadata":{},"sourceType":"module"}